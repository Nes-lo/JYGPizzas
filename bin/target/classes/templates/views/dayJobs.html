<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="plantilla/template :: head">

</head>
<body>
<header th:replace="plantilla/template :: header"></header>
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="cartera" viewBox="0 0 16 16" class="bi bi-briefcase">
        <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1h-3zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5zm1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0zM1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5z"/>
    </symbol>
    <symbol id="cotizacion" class="bi bi-file-spreadsheet" viewBox="0 0 16 16">
        <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v4h10V2a1 1 0 0 0-1-1H4zm9 6h-3v2h3V7zm0 3h-3v2h3v-2zm0 3h-3v2h2a1 1 0 0 0 1-1v-1zm-4 2v-2H6v2h3zm-4 0v-2H3v1a1 1 0 0 0 1 1h1zm-2-3h2v-2H3v2zm0-3h2V7H3v2zm3-2v2h3V7H6zm3 3H6v2h3v-2z"/>
    </symbol>
    <symbol id="table" viewBox="0 0 16 16">
        <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
    </symbol>
    <symbol id="grid" viewBox="0 0 16 16">
        <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
    </symbol>
    <symbol id="delete" viewBox="0 0 16 16" class="bi bi-trash3">
        <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
    </symbol>
    <symbol id="newClient" viewBox="0 0 16 16" class="bi bi-person-add">
        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
        <path d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z"/>
    </symbol>
    <symbol id="edit" viewBox="0 0 16 16" class="bi bi-pencil-square">
        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
        <path fill-rule="evenodd"
              d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
    </symbol>

    <symbol id="factura" viewBox="0 0 16 16" class="bi bi-newspaper">
        <path d="M0 2.5A1.5 1.5 0 0 1 1.5 1h11A1.5 1.5 0 0 1 14 2.5v10.528c0 .3-.05.654-.238.972h.738a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 1 1 0v9a1.5 1.5 0 0 1-1.5 1.5H1.497A1.497 1.497 0 0 1 0 13.5v-11zM12 14c.37 0 .654-.211.853-.441.092-.106.147-.279.147-.531V2.5a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v11c0 .278.223.5.497.5H12z"/>
        <path d="M2 3h10v2H2V3zm0 3h4v3H2V6zm0 4h4v1H2v-1zm0 2h4v1H2v-1zm5-6h2v1H7V6zm3 0h2v1h-2V6zM7 8h2v1H7V8zm3 0h2v1h-2V8zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1z"/>
    </symbol>
    <symbol id="close" viewBox="0 0 16 16" class="bi bi-power">
        <path d="M7.5 1v7h1V1h-1z"/>
        <path d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812z"/>
    </symbol>
    <symbol id="diner" viewBox="0 0 16 16" class="bi bi-cash-coin">
        <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0z"/>
        <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1h-.003zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195l.054.012z"/>
        <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083c.058-.344.145-.678.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1H1z"/>
        <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 5.982 5.982 0 0 1 3.13-1.567z"/>
    </symbol>

</svg>
<div class="container" th:if="${userLogger.roles.?[roleName.contains('gestor_usuario')].size() > 0}">
    <div class="border p-3 border-3 rounded">
        <div class="border p-3 border-3  rounded">
            <div class="row">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label>T Identificacion:</label>
                                <span class="fw-bold" th:text="${paymentPeriod.employee.documentTypeEmployee}" style="text-align: right;"></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label>Email:</label>
                                <span class="fw-bold" th:text="${paymentPeriod.employee.employeeEmail}"></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label>Identificacion:</label>
                                <span class="fw-bold" th:text="${paymentPeriod.employee.documentNumberEmployee}"></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label>Teléfono:</label>
                                <span class="fw-bold" th:text="${paymentPeriod.employee.employeePhone}"></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label>Empleado:</label>
                                <span class="fw-bold" th:text="${paymentPeriod.employee.employeeName}"></span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label>Dirección:</label>
                                <span class="fw-bold" th:text="${paymentPeriod.employee.employeeAddress}"></span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-md-4">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label>Periodo de Pagos Activo°</label><br>
                            <span class="fw-bold text-danger" th:text="${paymentPeriod.periodName}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


    <div class="row justify-content-center"  th:if="${paymentPeriod.statePeriod.contains('abierto')}">
        <div class="col-md-6 bg-light rounded">
            <form th:action="@{/dayjobs/newDayJob}" th:object="${dayJob}" method="post" class="row g-3"
                  id="formNewItem">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" th:field="*{paymentPeriod.id}">
                <div class="col-md-12">
                    <label for="workingDay" class="form-label">Dia Laborado</label>
                    <input type="text" class="form-control" id="workingDay" th:field="*{workingDay}" required><br>
                    <div class="valid-feedback">
                        Hecho!
                    </div>
                    <div class="invalid-feedback">
                        Porfavor ingrese la informacion requerida.
                    </div>
                </div>
                <small class="form-text text-danger" th:if="${#fields.hasErrors('workingDay')}"
                       th:errors="*{workingDay}"></small>

                <div class="col-md-6">
                    <label for="liquidationStatus" class="form-label">Estado</label>
                    <div class="input-group has-validation">
                        <span class="input-group-text">π</span>
                        <select class="form-select" id="liquidationStatus" th:field="*{liquidationStatus}" required>
                            <option selected disabled value="">Elegir...</option>
                            <option th:value="pendiente">Sin Pagar</option>
                            <option th:value="liquidado">Pagado</option>
                        </select><br>
                        <div class="valid-feedback">
                            Hecho!
                        </div>
                        <div class="invalid-feedback">
                            Porfavor seleccione una opcion valida.
                        </div>
                    </div>
                    <small class="form-text text-danger" th:if="${#fields.hasErrors('liquidationStatus')}"
                           th:errors="*{liquidationStatus}"></small>
                </div>

                <div class="col-md-6">
                    <label for="workingHour" class="form-label">Horas Trabajadas</label>
                    <div class="input-group has-validation">
                        <span class="input-group-text" id="workingH">#</span>
                        <input type="number" th:field="*{workingHour}" class="form-control" id="workingHour" required><br>
                        <div class="valid-feedback">
                            Hecho!
                        </div>
                        <div class="invalid-feedback">
                            Porfavor ingrese la informacion requerida.
                        </div>
                    </div>
                    <small class="form-text text-danger" th:if="${#fields.hasErrors('workingHour')}"
                           th:errors="*{workingHour}"></small>
                </div>

                <div class="col-md-12">
                    <label for="descriptionDayJob" class="form-label">Observaciones</label>
                    <div class="input-group has-validation">
                        <span class="input-group-text" id="description">@</span>
                        <textarea th:field="*{descriptionDayJob}" placeholder="Observaciones..." class="form-control"
                                  id="descriptionDayJob"></textarea>
                        <div class="valid-feedback">
                            Hecho!
                        </div>
                        <div class="invalid-feedback">
                            Porfavor ingrese la informacion requerida.
                        </div>
                    </div>
                    <small class="form-text text-danger" th:if="${#fields.hasErrors('descriptionDayJob')}"
                           th:errors="*{descriptionDayJob}"></small>
                </div>

                <div class="mb-3 text-center">
                    <button class="btn btn-secondary" type="submit">Guardar Horas</button>
                </div>
            </form>
        </div>
    </div>
<h1 style="text-align:center;">Dias Trabajados en el Periodo</h1>
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th class="text-center">Id</th>
            <th class="text-center">Dia Laborado</th>
            <th class="text-center">Numero de Horas</th>
            <th class="text-center">Valor  Horas</th>
            <th class="text-center">Estado</th>
            <th class="text-center">Descripcion</th>
            <th class="text-center"  th:if="${paymentPeriod.statePeriod.contains('abierto')}">Liquidar</th>
            <th class="text-center" th:if="${paymentPeriod.statePeriod.contains('abierto')}">Anular</th>

        </tr>
        </thead>
        <tbody>
        <tr th:each="dayJob : ${dayJobs}">
            <td class="text-dark text-center"><span th:text="${dayJob.id}"></span></td>
            <td class="text-dark text-center"><span th:text="${dayJob.workingDay}"></span></td>
            <td class="text-dark text-center"><span th:text="${dayJob.workingHour}"></span></td>
            <td class="text-dark text-center" th:text="${dayJob.workingHour * dayJob.paymentPeriod.employee.valueHourWorked}"
                th:attr="data-value=${dayJob.workingHour * dayJob.paymentPeriod.employee.valueHourWorked}" style="text-align: right;"></td>
            <script th:inline="javascript">
    var value = parseFloat([[${dayJob.workingHour * dayJob.paymentPeriod.employee.valueHourWorked}]]);
    var formatter = new Intl.NumberFormat('es-CO', {
        style: 'currency',
        currency: 'COP',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    });
    var formattedValue = formatter.format(value);
    document.querySelector("[data-value='[[${dayJob.workingHour * dayJob.paymentPeriod.employee.valueHourWorked}]]']").textContent = formattedValue;
        </script>
            <td class="text-dark text-center"><span th:text="${dayJob.liquidationStatus}"></span></td>
            <td class="text-dark text-center"><span th:text="${dayJob.descriptionDayJob}"></span></td>
          <div th:if="${paymentPeriod.statePeriod.contains('abierto')}">
            <td class="text-center" th:if="${userLogger.roles.?[roleName.contains('gestor_usuario')].size() > 0}">
                <div th:if="${dayJob.liquidationStatus.contains('pendiente')}">
                    <a class="nav-link active btn btn-light btn-sm text-primary"
                        th:href="@{/dayjobs/edit/{paymentPeriodId}/{dayJobId}(paymentPeriodId=${paymentPeriod.id}, dayJobId=${dayJob.id})}">
                        Liquidar Dia</a>
                    <!--  th:href="@{/dayjobs/edit/} + ${paymentPeriod.id}+ @{/} + ${dayJob.id}"> -->
                </div>
            </td>

            <td class="text-center" th:if="${userLogger.roles.?[roleName.contains('gestor_usuario')].size() > 0}">

                <div th:if="${!dayJob.liquidationStatus.contains('anulado')}">
                    <a class="nav-link active btn btn-light btn-sm text-primary"
                       th:href="@{/dayjobs/anular/{paymentPeriodId}/{dayJobId}(paymentPeriodId=${paymentPeriod.id}, dayJobId=${dayJob.id})}"
                       th:text="'Anular Dia'" title="Anular Registro"
                       onclick="return confirm('¿Está seguro que desea anular el día?');">
                    </a>
                </div>

            </td>
           </div>
        </tr>
        </tbody>
    </table>



<div class="col-11  d-flex justify-content-end">
    <div class="col-3  d-flex justify-content-end form-group border border-3">
        <label class="me-3"  th:if="${paymentPeriod.statePeriod.contains('abierto')}" >Saldo Pendiente X Liquidar:</label>
        <label class="me-3"  th:if="${!paymentPeriod.statePeriod.contains('abierto')}" >Saldo Liquidado:</label>
        <span class="fw-bold" th:text="'$' + ${#numbers.formatCurrency(valPendiente)}"></span>
    </div>
</div>

<div class="col-12  d-flex justify-content-center"  th:if="${paymentPeriod.statePeriod.contains('abierto')}">
<div class="col-3 " th:if="${userLogger.roles.?[roleName.contains('gestor_usuario')].size() > 0}">
    <a class="nav-link active btn btn-warning  btn-sm text-dark"
       th:href="@{/dayjobs/liquid/{id}(id=${paymentPeriod.id})}"
       th:text="'Liquidar Periodo De Pago'" title="Liquidar Periodo"
       onclick="return confirm('¿Está seguro que desea liquidar el periodo? \n despues de liquidado no se podra hacer ninguna adición o modificacion.');">
    </a>
</div>
</div>

<!--
<div class="col-11 d-flex justify-content-end">
<div class="col-2">
    <label for="saldo" class="form-label">Saldo Pendiente X Liquidar:</label>
    <div class="input-group col-md-3">
        <span class="input-group-text" id="saldoP">$</span>
        <input type="text" th:value="${#numbers.formatCurrency(valPendiente)}"  class="form-control text-end" id="saldo" readonly><br>
    </div>
</div>
</div>
-->
</div>
<br><br><br><br><br><br>
<footer th:replace="plantilla/template :: footer"></footer>
</body>
</html>